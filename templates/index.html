<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <title>èˆ†æƒ…åˆ†æç³»ç»Ÿï¼šçˆ¬å–/ä¸Šä¼  + AIæ¸…æ´—</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
  <script src="https://unpkg.com/element-plus"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <!-- å¼•å…¥å›¾æ ‡åº“ -->
  <script src="https://unpkg.com/@element-plus/icons-vue"></script>
  <!-- å¼•å…¥ECharts -->
  <script src="https://unpkg.com/echarts@5/dist/echarts.min.js"></script>
  <!-- å¼•å…¥EChartsè¯äº‘æ‰©å±• -->
  <script src="https://unpkg.com/echarts-wordcloud@2/dist/echarts-wordcloud.min.js"></script>
  <style>
    body {
      padding: 20px;
      background-color: #f5f7fa;
      font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', sans-serif;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    .control-panel {
      background: #fafafa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #ebeef5;
    }

    .upload-tip {
      font-size: 12px;
      color: #909399;
      margin-top: 5px;
    }

    .ai-badge {
      margin-top: 10px;
      display: block;
      white-space: pre-wrap;
      background: #f0f9eb;
      padding: 10px;
      border-radius: 4px;
      font-size: 13px;
      color: #67c23a;
      border: 1px solid #e1f3d8;
    }

    .comment-tag {
      margin-right: 5px;
      margin-bottom: 5px;
      display: inline-block;
      white-space: normal;
      height: auto;
      padding: 5px;
    }

    /* æ•™ç¨‹æ ·å¼ */
    .tutorial-step {
      margin-bottom: 15px;
      border-bottom: 1px dashed #eee;
      padding-bottom: 10px;
    }

    .tutorial-step:last-child {
      border-bottom: none;
    }

    .step-title {
      font-weight: bold;
      color: #409EFF;
      margin-bottom: 5px;
      display: block;
    }

    .code-block {
      background: #f4f4f5;
      padding: 5px 10px;
      border-radius: 4px;
      font-family: monospace;
      color: #c0392b;
      display: inline-block;
      margin-top: 5px;
    }

    /* è¯äº‘åˆ†æé¢æ¿æ ·å¼ */
    .analysis-panel {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      color: #fff;
    }

    .analysis-panel h3 {
      color: #fff;
      margin-bottom: 15px;
    }

    .chart-container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .chart-box {
      background: #fff;
      border-radius: 8px;
      padding: 15px;
      flex: 1;
      min-width: 400px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .chart-title {
      color: #303133;
      font-weight: bold;
      margin-bottom: 10px;
      font-size: 16px;
    }

    #wordcloud-chart {
      width: 100%;
      height: 400px;
    }

    #sentiment-chart {
      width: 100%;
      height: 400px;
    }

    .stats-summary {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
    }

    .stat-item {
      background: rgba(255, 255, 255, 0.2);
      padding: 10px 20px;
      border-radius: 8px;
      text-align: center;
    }

    .stat-value {
      font-size: 24px;
      font-weight: bold;
    }

    .stat-label {
      font-size: 12px;
      opacity: 0.9;
    }

    /* ç”¨æˆ·ç™»å½•åŒºåŸŸæ ·å¼ */
    .user-section {
      position: absolute;
      right: 30px;
      top: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid #409EFF;
    }

    .user-name {
      font-size: 14px;
      color: #303133;
      font-weight: 500;
    }

    .login-btn {
      background: linear-gradient(135deg, #C71D23, #E33E38);
      border: none;
      color: #fff;
      font-weight: bold;
    }

    .login-btn:hover {
      background: linear-gradient(135deg, #E33E38, #C71D23);
    }

    .container {
      position: relative;
    }

    /* ç™»å½•æˆåŠŸå¼¹çª—æ ·å¼ */
    .login-success-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .login-success-card {
      background: #fff;
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .login-success-card img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid #67C23A;
      margin-bottom: 15px;
    }

    .login-success-card h2 {
      color: #67C23A;
      margin-bottom: 10px;
    }

    .login-success-card p {
      color: #909399;
    }
  </style>
</head>

<body>
  <div id="app" class="container">
    <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸï¼ˆä» localStorage JWT è·å–ï¼‰ -->
    <div class="user-section" v-if="currentUser">
      <el-dropdown trigger="click" @command="handleUserCommand">
        <div style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
          <img :src="currentUser.avatar_url || 'https://via.placeholder.com/36'" class="user-avatar"
            :alt="currentUser.username">
          <span class="user-name">{% raw %}{{ currentUser.username }}{% endraw %}</span>
          <el-icon><arrow-down /></el-icon>
        </div>
        <template #dropdown>
          <el-dropdown-menu>
            <el-dropdown-item command="settings">
              <el-icon>
                <setting />
              </el-icon> ä¸ªäººè®¾ç½®
            </el-dropdown-item>
            <el-dropdown-item command="password">
              <el-icon>
                <lock />
              </el-icon> ä¿®æ”¹å¯†ç 
            </el-dropdown-item>
            <el-dropdown-item divided command="logout">
              <el-icon><switch-button /></el-icon> é€€å‡ºç™»å½•
            </el-dropdown-item>
          </el-dropdown-menu>
        </template>
      </el-dropdown>
    </div>
    <div class="user-section" v-else>
      <el-button type="primary" @click="goToLogin">è¯·å…ˆç™»å½•</el-button>
    </div>

    <div class="header">
      <h1>ğŸ•·ï¸ èˆ†æƒ…æ•°æ®è·å–ä¸ AI åˆ†æç³»ç»Ÿ</h1>
    </div>

    <el-tabs v-model="activeTab" type="border-card" class="control-panel">

      <!-- æ¨¡å¼ä¸€ï¼šåœ¨çº¿çˆ¬å– -->
      <el-tab-pane label="åœ¨çº¿çˆ¬è™«è·å–" name="crawl">
        <div style="display: flex; flex-direction: column; gap: 15px;">

          <!-- ç¬¬ä¸€è¡Œï¼šåŸºç¡€è®¾ç½® -->
          <div style="display: flex; gap: 10px; align-items: center;">
            <el-input v-model="keyword" placeholder="è¾“å…¥å…³é”®è¯ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš” (å¦‚: AIé—®è¯Š,æ™ºèƒ½åŒ»ç–—,äººå·¥æ™ºèƒ½åŒ»ç”Ÿ)"
              style="width: 400px;"></el-input>

            <el-select v-model="platform" placeholder="é€‰æ‹©å¹³å°" style="width: 120px;">
              <el-option label="å°çº¢ä¹¦" value="xhs"></el-option>
              <el-option label="çŸ¥ä¹" value="zhihu"></el-option>
            </el-select>

            <el-input-number v-model="crawlCount" :min="1" :step="10" style="width: 130px;"
              placeholder="æ¯è¯æ•°é‡"></el-input-number>
            <span style="font-size: 12px; color: #909399;">æ¡/è¯</span>

            <el-button type="primary" @click="startCrawl" :loading="loading" :disabled="loading">ğŸš€ å¼€å§‹çˆ¬å–</el-button>
            <el-button type="danger" @click="stopCrawl" v-if="loading">â¹ï¸ åœæ­¢</el-button>
          </div>

          <!-- ç¬¬äºŒè¡Œï¼šçŸ¥ä¹ Cookie ä¸“ç”¨è®¾ç½® -->
          <div v-if="platform === 'zhihu'"
            style="display: flex; gap: 10px; align-items: center; background: #ecf5ff; padding: 10px; border-radius: 4px;">
            <span style="font-size: 14px; color: #606266; width: 60px;">Cookie:</span>
            <el-input v-model="zhihuCookie" type="password" show-password placeholder="åœ¨æ­¤ç²˜è´´çŸ¥ä¹ Cookieï¼ˆå¿…å¡«ï¼‰"
              style="flex: 1;" clearable></el-input>

            <!-- å¸®åŠ©æŒ‰é’® -->
            <el-button type="info" circle @click="showHelp = true">
              <el-icon>
                <QuestionFilled />
              </el-icon>
            </el-button>
            <span style="font-size: 12px; color: #909399;">ç‚¹å‡»é—®å·æŸ¥çœ‹è·å–æ–¹æ³•</span>
          </div>

          <div class="upload-tip">è¯´æ˜ï¼šçˆ¬è™«å°†è‡ªåŠ¨è¿‡æ»¤æ— æ•ˆè¯„è®ºå’Œå®˜æ–¹è´¦å·è¯„è®ºã€‚</div>
        </div>
      </el-tab-pane>

      <!-- æ¨¡å¼äºŒï¼šCSVä¸Šä¼  -->
      <el-tab-pane label="CSV æ–‡ä»¶ä¸Šä¼ " name="upload">
        <div style="display: flex; flex-direction: column; gap: 15px;">
          <div style="display: flex; gap: 20px; align-items: start;">
            <div>
              <el-button @click="downloadTemplate" icon="el-icon-download">ğŸ“¥ ä¸‹è½½æ ‡å‡†æ¨¡æ¿</el-button>
              <div class="upload-tip">æ¨¡æ¿æ ¼å¼ï¼škeyword, url, user, comment_content<br>ä¸çˆ¬å–å¯¼å‡ºæ ¼å¼ä¸€è‡´ï¼Œå¯ç›´æ¥å¯¼å…¥ä¹‹å‰çˆ¬å–çš„æ•°æ®</div>
            </div>

            <el-upload class="upload-demo" :action="uploadAction" :show-file-list="false"
              :on-success="handleUploadSuccess" :on-error="handleUploadError" :before-upload="beforeUpload"
              accept=".csv" :data="uploadParams">
              <el-button type="success">ğŸ“¤ ç‚¹å‡»ä¸Šä¼  CSV å¹¶æ¸…æ´—</el-button>
            </el-upload>
          </div>

          <!-- è¿‡æ»¤è®¾ç½® -->
          <div style="background: #fef0f0; padding: 12px; border-radius: 4px; border: 1px solid #fde2e2;">
            <div style="margin-bottom: 8px; font-size: 14px; color: #f56c6c; font-weight: bold;">ğŸ” è¿‡æ»¤è®¾ç½®ï¼ˆå¯é€‰ï¼‰</div>
            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
              <el-input v-model="filterKeywords" placeholder="è¿‡æ»¤å…³é”®è¯ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš” (å¦‚: å¹¿å‘Š,æ¨å¹¿,å¾®ä¿¡)" style="width: 350px;"
                clearable></el-input>
              <el-input-number v-model="minCommentLength" :min="1" :max="100" :step="1" style="width: 150px;"
                placeholder="æœ€çŸ­è¯„è®ºé•¿åº¦"></el-input-number>
              <span style="font-size: 12px; color: #909399;">å­—ç¬¦ä»¥ä¸Š</span>
            </div>
            <div class="upload-tip" style="margin-top: 8px;">è¯´æ˜ï¼šåŒ…å«è¿‡æ»¤å…³é”®è¯çš„è¯„è®ºå°†è¢«è¿‡æ»¤ï¼Œé•¿åº¦ä¸è¶³çš„è¯„è®ºä¹Ÿå°†è¢«è¿‡æ»¤ã€‚</div>
          </div>
        </div>
      </el-tab-pane>

      <!-- æ¨¡å¼ä¸‰ï¼šTXTåˆ†æ & è¯äº‘ç”Ÿæˆ -->
      <el-tab-pane label="ğŸ“Š TXTåˆ†æ & è¯äº‘" name="wordcloud">
        <div style="display: flex; flex-direction: column; gap: 20px;">

          <!-- è¯´æ˜æ–‡å­— -->
          <el-alert title="åŠŸèƒ½è¯´æ˜" type="info" :closable="false">
            <template #default>
              <p>1. ä¸Šä¼ AIåˆ†æç»“æœTXTæ–‡ä»¶ï¼ˆJSONæ•°ç»„æ ¼å¼ï¼ŒåŒ…å«is_valid, keywords, sentimentå­—æ®µï¼‰</p>
              <p>2. ç³»ç»Ÿè‡ªåŠ¨è¿‡æ»¤is_valid=falseçš„æ— æ•ˆæ•°æ®</p>
              <p>3. ç”Ÿæˆå…³é”®è¯è¯äº‘å’Œæƒ…æ„Ÿåˆ†å¸ƒå›¾</p>
              <p>4. å¯é€‰ï¼šåˆå¹¶åŸå§‹CSVå’ŒTXTï¼Œå¯¼å‡ºå¸¦åˆ†æç»“æœçš„CSV</p>
            </template>
          </el-alert>

          <!-- ä¸Šä¼ åŒºåŸŸ -->
          <div style="display: flex; gap: 20px; flex-wrap: wrap;">

            <!-- ä¸Šä¼ TXTåˆ†æç»“æœ -->
            <div style="flex: 1; min-width: 300px;">
              <div style="font-weight: bold; margin-bottom: 10px; color: #409EFF;">ğŸ“„ ä¸Šä¼ TXTåˆ†æç»“æœ</div>
              <el-upload ref="txtUploadRef" :action="'#'" :auto-upload="false" :on-change="handleTxtChange"
                accept=".txt,.json" :limit="1" :on-exceed="() => ElMessage.warning('åªèƒ½ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶')">
                <template #trigger>
                  <el-button type="primary">é€‰æ‹©TXTæ–‡ä»¶</el-button>
                </template>
              </el-upload>
              <el-button type="success" @click="analyzeTxt" :loading="txtAnalyzing" style="margin-top: 10px;">
                ğŸ” åˆ†æå¹¶ç”Ÿæˆè¯äº‘
              </el-button>
            </div>

            <!-- åˆå¹¶CSVå’ŒTXT -->
            <div style="flex: 1; min-width: 300px;">
              <div style="font-weight: bold; margin-bottom: 10px; color: #E6A23C;">ğŸ”— åˆå¹¶CSV + TXTï¼ˆå¯é€‰ï¼‰</div>
              <div style="display: flex; flex-direction: column; gap: 10px;">
                <el-upload ref="mergeCSVRef" :action="'#'" :auto-upload="false" :on-change="handleMergeCSVChange"
                  accept=".csv" :limit="1">
                  <template #trigger>
                    <el-button size="small">é€‰æ‹©åŸå§‹CSV</el-button>
                  </template>
                  <template #tip>
                    <div class="upload-tip">åŸå§‹çˆ¬å–çš„CSVæ–‡ä»¶</div>
                  </template>
                </el-upload>
                <el-upload ref="mergeTXTRef" :action="'#'" :auto-upload="false" :on-change="handleMergeTXTChange"
                  accept=".txt,.json" :limit="1">
                  <template #trigger>
                    <el-button size="small">é€‰æ‹©åˆ†æTXT</el-button>
                  </template>
                  <template #tip>
                    <div class="upload-tip">AIåˆ†æç»“æœTXT</div>
                  </template>
                </el-upload>
                <el-button type="warning" @click="mergeAndDownload" :loading="merging">
                  ğŸ“¥ åˆå¹¶å¹¶ä¸‹è½½CSV
                </el-button>
              </div>
            </div>

            <!-- ä¸Šä¼ å·²åˆå¹¶çš„CSV -->
            <div style="flex: 1; min-width: 300px;">
              <div style="font-weight: bold; margin-bottom: 10px; color: #67C23A;">ğŸ“ˆ åˆ†æå·²åˆå¹¶CSV</div>
              <el-upload ref="mergedCSVRef" :action="'#'" :auto-upload="false" :on-change="handleMergedCSVChange"
                accept=".csv" :limit="1">
                <template #trigger>
                  <el-button type="success">é€‰æ‹©å·²åˆå¹¶CSV</el-button>
                </template>
                <template #tip>
                  <div class="upload-tip">åŒ…å«keywordså’Œsentimentåˆ—çš„CSV</div>
                </template>
              </el-upload>
              <el-button type="success" @click="analyzeMergedCSV" :loading="csvAnalyzing" style="margin-top: 10px;">
                ğŸ“Š ç”Ÿæˆè¯äº‘
              </el-button>
            </div>
          </div>

          <!-- åˆ†éš”çº¿ -->
          <el-divider content-position="center">
            <span style="color: #909399; font-size: 14px;">ğŸ“ å¤šCSVæ–‡ä»¶æ‰¹é‡æ“ä½œ</span>
          </el-divider>

          <!-- å¤šCSVæ“ä½œåŒºåŸŸ -->
          <div style="display: flex; gap: 20px; flex-wrap: wrap;">

            <!-- å¤šCSVåˆå¹¶ -->
            <div
              style="flex: 1; min-width: 350px; background: #fef0f0; padding: 15px; border-radius: 8px; border: 1px solid #fde2e2;">
              <div style="font-weight: bold; margin-bottom: 10px; color: #F56C6C;">ğŸ”— å¤šCSVåˆå¹¶ä¸‹è½½</div>
              <el-upload ref="multiMergeRef" :action="'#'" :auto-upload="false" :on-change="handleMultiMergeChange"
                :file-list="multiMergeFiles" accept=".csv" multiple>
                <template #trigger>
                  <el-button type="danger" plain>é€‰æ‹©å¤šä¸ªCSVæ–‡ä»¶</el-button>
                </template>
                <template #tip>
                  <div class="upload-tip">é€‰æ‹©2ä¸ªæˆ–æ›´å¤šCSVæ–‡ä»¶è¿›è¡Œåˆå¹¶</div>
                </template>
              </el-upload>
              <div style="margin-top: 10px;">
                <el-button type="danger" @click="mergeMultipleCSV" :loading="multiMerging"
                  :disabled="multiMergeFiles.length < 2">
                  ğŸ“¥ åˆå¹¶ {% raw %}{{ multiMergeFiles.length }}{% endraw %} ä¸ªæ–‡ä»¶å¹¶ä¸‹è½½
                </el-button>
                <el-button @click="clearMultiMerge" size="small" v-if="multiMergeFiles.length > 0">æ¸…ç©º</el-button>
              </div>
            </div>

            <!-- å¤šCSVç»Ÿä¸€åˆ†æ -->
            <div
              style="flex: 1; min-width: 350px; background: #f0f9eb; padding: 15px; border-radius: 8px; border: 1px solid #e1f3d8;">
              <div style="font-weight: bold; margin-bottom: 10px; color: #67C23A;">ğŸ“Š å¤šCSVç»Ÿä¸€åˆ†æ</div>
              <el-upload ref="multiAnalyzeRef" :action="'#'" :auto-upload="false" :on-change="handleMultiAnalyzeChange"
                :file-list="multiAnalyzeFiles" accept=".csv" multiple>
                <template #trigger>
                  <el-button type="success" plain>é€‰æ‹©å¤šä¸ªCSVæ–‡ä»¶</el-button>
                </template>
                <template #tip>
                  <div class="upload-tip">æ”¯æŒå·²åˆ†æCSVï¼ˆå«keywords/sentimentåˆ—ï¼‰æˆ–åŸå§‹CSV</div>
                </template>
              </el-upload>
              <div style="margin-top: 10px;">
                <el-button type="success" @click="analyzeMultipleCSV" :loading="multiAnalyzing"
                  :disabled="multiAnalyzeFiles.length === 0">
                  ğŸ“Š åˆ†æ {% raw %}{{ multiAnalyzeFiles.length }}{% endraw %} ä¸ªæ–‡ä»¶ç”Ÿæˆè¯äº‘
                </el-button>
                <el-button @click="clearMultiAnalyze" size="small" v-if="multiAnalyzeFiles.length > 0">æ¸…ç©º</el-button>
              </div>
            </div>
          </div>
        </div>
      </el-tab-pane>

      <!-- ğŸ“¡ èˆ†æƒ…è®¢é˜… & å‘Šè­¦ -->
      <el-tab-pane label="ğŸ“¡ èˆ†æƒ…è®¢é˜… & å‘Šè­¦" name="watch">
        <div style="display: flex; gap: 20px; flex-wrap: wrap;">

          <!-- åˆ›å»ºè®¢é˜… -->
          <el-card style="width: 420px;">
            <template #header>åˆ›å»ºè®¢é˜…</template>

            <el-form label-width="90px" size="small">
              <el-form-item label="å…³é”®è¯">
                <el-input v-model="watchForm.keyword" placeholder="å¦‚ï¼šAIé—®è¯Š" />
              </el-form-item>

              <el-form-item label="å¹³å°">
                <el-select v-model="watchForm.platform">
                  <el-option label="å°çº¢ä¹¦" value="xhs" />
                  <el-option label="çŸ¥ä¹" value="zhihu" />
                </el-select>
              </el-form-item>

              <el-form-item label="å‘¨æœŸ(åˆ†)">
                <el-input-number v-model="watchForm.interval_minutes" :min="1" />
              </el-form-item>

              <el-form-item label="è´Ÿé¢é˜ˆå€¼">
                <el-input-number v-model="watchForm.negative_threshold" :min="1" />
              </el-form-item>

              <el-form-item label="å‘Šè­¦é‚®ç®±">
                <el-input v-model="watchForm.email" />
              </el-form-item>

              <el-form-item>
                <el-button type="primary" @click="createWatch">åˆ›å»ºè®¢é˜…</el-button>
                <el-button @click="fetchWatches">åˆ·æ–°åˆ—è¡¨</el-button>
              </el-form-item>
            </el-form>
          </el-card>

          <!-- è®¢é˜…åˆ—è¡¨ -->
          <el-card style="flex: 1;">
            <template #header>
              è®¢é˜…åˆ—è¡¨
              <el-button size="small" style="float:right" @click="fetchWatches">åˆ·æ–°</el-button>
            </template>

            <el-table :data="watchList" border style="width: 100%">
              <el-table-column label="å…³é”®è¯" width="160">
                <template #default="s">
                  <span v-text="s.row.keyword || '-'"></span>
                </template>
              </el-table-column>

              <el-table-column label="å¹³å°" width="100">
                <template #default="s">
                  <span
                    v-text="s.row.platform === 'xhs' ? 'å°çº¢ä¹¦' : (s.row.platform === 'zhihu' ? 'çŸ¥ä¹' : (s.row.platform || '-'))"></span>
                </template>
              </el-table-column>

              <el-table-column label="å‘¨æœŸ(s)" width="120">
                <template #default="s">
                  <span v-text="(s.row.interval_seconds ?? '-')"></span>
                </template>
              </el-table-column>

              <el-table-column label="è´Ÿé¢é˜ˆå€¼" width="110">
                <template #default="s">
                  <span v-text="(s.row.negative_threshold ?? '-')"></span>
                </template>
              </el-table-column>

              <el-table-column label="å‘Šè­¦é‚®ç®±" min-width="200">
                <template #default="s">
                  <span v-text="(s.row.notify && s.row.notify.email) ? s.row.notify.email : '-'"></span>
                </template>
              </el-table-column>

              <el-table-column label="çŠ¶æ€" width="90">
                <template #default="s">
                  <el-tag :type="s.row.enabled ? 'success' : 'info'">
                    <span v-text="s.row.enabled ? 'å¯ç”¨' : 'åœç”¨'"></span>
                  </el-tag>
                </template>
              </el-table-column>

              <el-table-column label="æ“ä½œ" width="240">
                <template #default="s">
                  <el-button size="small" @click="toggleWatch(s.row)">
                    <span v-text="s.row.enabled ? 'åœç”¨' : 'å¯ç”¨'"></span>
                  </el-button>
                  <el-button size="small" type="warning" @click="testWatch(s.row)">æµ‹è¯•</el-button>
                  <el-button size="small" type="danger" @click="deleteWatch(s.row)">åˆ é™¤</el-button>
                </template>
              </el-table-column>
            </el-table>
          </el-card>

        </div>
      </el-tab-pane>

    </el-tabs>

    <!-- è¯äº‘åˆ†æç»“æœå±•ç¤º -->
    <div v-if="wordcloudData.length > 0" class="analysis-panel">
      <h3>ğŸ“Š åˆ†æç»“æœå¯è§†åŒ–</h3>

      <!-- æ–‡ä»¶ç»Ÿè®¡ï¼ˆå¤šæ–‡ä»¶æ—¶æ˜¾ç¤ºï¼‰ -->
      <div v-if="fileStats.length > 1" style="margin-bottom: 15px;">
        <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px;">
          <div style="font-weight: bold; margin-bottom: 8px;">ğŸ“ æ–‡ä»¶ç»Ÿè®¡ï¼ˆå…± {% raw %}{{ fileStats.length }}{% endraw %} ä¸ªæ–‡ä»¶ï¼‰
          </div>
          <div style="display: flex; flex-wrap: wrap; gap: 10px;">
            <el-tag v-for="(f, idx) in fileStats" :key="idx" type="info" effect="plain">
              {% raw %}{{ f.name }}{% endraw %}: {% raw %}{{ f.rows }}{% endraw %} æ¡
            </el-tag>
          </div>
        </div>
      </div>

      <!-- ç»Ÿè®¡æ‘˜è¦ -->
      <div class="stats-summary">
        <div class="stat-item">
          <div class="stat-value">{% raw %}{{ analysisStats.total }}{% endraw %}</div>
          <div class="stat-label">æ€»æ•°æ®é‡</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{% raw %}{{ analysisStats.validCount }}{% endraw %}</div>
          <div class="stat-label">æœ‰æ•ˆæ•°æ®</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{% raw %}{{ wordcloudData.length }}{% endraw %}</div>
          <div class="stat-label">å…³é”®è¯æ•°</div>
        </div>
        <div class="stat-item" style="background: rgba(103,194,58,0.3);">
          <div class="stat-value">{% raw %}{{ sentimentStats.positive }}{% endraw %}</div>
          <div class="stat-label">æ­£é¢è¯„ä»·</div>
        </div>
        <div class="stat-item" style="background: rgba(245,108,108,0.3);">
          <div class="stat-value">{% raw %}{{ sentimentStats.negative }}{% endraw %}</div>
          <div class="stat-label">è´Ÿé¢è¯„ä»·</div>
        </div>
        <div class="stat-item" style="background: rgba(144,147,153,0.3);">
          <div class="stat-value">{% raw %}{{ sentimentStats.neutral }}{% endraw %}</div>
          <div class="stat-label">ä¸­æ€§è¯„ä»·</div>
        </div>
      </div>

      <!-- å›¾è¡¨åŒºåŸŸ -->
      <div class="chart-container">
        <div class="chart-box">
          <div class="chart-title">ğŸ”¤ å…³é”®è¯è¯äº‘</div>
          <div id="wordcloud-chart"></div>
        </div>
        <div class="chart-box">
          <div class="chart-title">ğŸ“ˆ æƒ…æ„Ÿåˆ†å¸ƒ</div>
          <div id="sentiment-chart"></div>
        </div>
      </div>

      <!-- Topå…³é”®è¯åˆ—è¡¨ -->
      <div style="margin-top: 20px; background: #fff; border-radius: 8px; padding: 15px;">
        <div style="font-weight: bold; color: #303133; margin-bottom: 10px;">ğŸ† Top 20 é«˜é¢‘å…³é”®è¯</div>
        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
          <el-tag v-for="(item, idx) in wordcloudData.slice(0, 20)" :key="idx"
            :type="idx < 3 ? 'danger' : idx < 10 ? 'warning' : 'info'" size="large">
            {% raw %}{{ item.name }}{% endraw %} ({% raw %}{{ item.value }}{% endraw %})
          </el-tag>
        </div>
      </div>
    </div>

    <!-- çˆ¬å–è¿›åº¦æ˜¾ç¤º -->
    <div v-if="crawlProgress.total > 0"
      style="margin-bottom: 15px; background: #f0f9eb; padding: 15px; border-radius: 8px; border: 1px solid #e1f3d8;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
        <span style="font-weight: bold; color: #67c23a;">ğŸ“Š çˆ¬å–è¿›åº¦</span>
        <span style="color: #909399;">{% raw %}{{ crawlProgress.current }}{% endraw %} / {% raw %}{{ crawlProgress.total
          }}{% endraw %} æ¡</span>
      </div>
      <el-progress :percentage="crawlProgress.percent" :status="crawlProgress.percent >= 100 ? 'success' : ''"
        :stroke-width="12"></el-progress>
      <div style="margin-top: 8px; font-size: 12px; color: #909399;">
        å½“å‰çŠ¶æ€ï¼š{% raw %}{{ crawlProgress.status }}{% endraw %} | å»é‡åï¼š{% raw %}{{ tableData.length }}{% endraw %} æ¡
      </div>
    </div>

    <!-- AIåˆ†æè¿›åº¦æ˜¾ç¤º -->
    <div v-if="analyzeProgress.totalBatches > 0"
      style="margin-bottom: 15px; background: #ecf5ff; padding: 15px; border-radius: 8px; border: 1px solid #d9ecff;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
        <span style="font-weight: bold; color: #409EFF;">ğŸ¤– AIåˆ†æè¿›åº¦</span>
        <span style="color: #909399;">ç¬¬ {% raw %}{{ analyzeProgress.currentBatch }}{% endraw %} / {% raw %}{{
          analyzeProgress.totalBatches }}{% endraw %} æ‰¹ï¼ˆæ¯æ‰¹ {% raw %}{{ analyzeProgress.batchSize }}{% endraw %}
          æ¡ï¼‰</span>
      </div>
      <el-progress :percentage="analyzeProgress.percent" :status="analyzeProgress.percent >= 100 ? 'success' : ''"
        :stroke-width="12" color="#409EFF"></el-progress>
      <div style="margin-top: 8px; font-size: 12px; color: #909399;">
        å½“å‰çŠ¶æ€ï¼š{% raw %}{{ analyzeProgress.status }}{% endraw %}
      </div>
      <!-- æ‰¹æ¬¡ç»“æœåˆ—è¡¨ -->
      <div v-if="analyzeProgress.results.length > 0" style="margin-top: 10px; max-height: 150px; overflow-y: auto;">
        <div v-for="(r, idx) in analyzeProgress.results" :key="idx"
          style="background: #fff; padding: 8px; margin-bottom: 5px; border-radius: 4px; font-size: 12px; border: 1px solid #e4e7ed;">
          <strong>æ‰¹æ¬¡ {% raw %}{{ r.batch_num }}{% endraw %}ï¼š</strong> å¤„ç† {% raw %}{{ r.count }}{% endraw %} æ¡
          <span style="color: #67c23a;">âœ“</span>
        </div>
      </div>
    </div>

    <!-- å…¨å±€æ“ä½œæ  -->
    <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
      <h3>ğŸ“Š æ•°æ®åˆ—è¡¨ (å…± {% raw %}{{ tableData.length }}{% endraw %} æ¡ï¼Œå½“å‰æ˜¾ç¤ºç¬¬ {% raw %}{{ currentPage }}{% endraw %} é¡µ)</h3>
      <div style="display: flex; gap: 10px;">
        <el-button type="success" @click="downloadData" :disabled="tableData.length === 0">
          ğŸ“¥ ä¸‹è½½æ•°æ® (CSV)
        </el-button>
        <el-input-number v-model="analyzeCount" :min="0" :step="10" style="width: 130px;" placeholder="åˆ†ææ•°é‡">
        </el-input-number>
        <span style="font-size: 12px; color: #909399; align-self: center;">æ¡ (0=å…¨éƒ¨)</span>
        <el-button type="warning" size="large" @click="startBatchAnalyze" :loading="analyzing"
          :disabled="tableData.length === 0">
          ğŸ¤– AI æ‰¹é‡æƒ…æ„Ÿåˆ†æ
        </el-button>
      </div>
    </div>

    <!-- æ•°æ®è¡¨æ ¼ -->
    <el-table :data="pagedData" border style="width: 100%" v-loading="loading && tableData.length === 0"
      max-height="600">
      <el-table-column prop="source" label="æ¥æº" width="100"></el-table-column>
      <el-table-column prop="title" label="æ ‡é¢˜/ä¸»é¢˜" width="200"></el-table-column>

      <el-table-column label="æ¸…æ´—åçš„è¯„è®º/å†…å®¹">
        <template #default="scope">
          <div v-if="scope.row.comments && scope.row.comments.length">
            <el-tag v-for="(c, index) in scope.row.comments" :key="index" class="comment-tag" size="small" type="info">
              {% raw %}{{ c }}{% endraw %}
            </el-tag>
          </div>
          <div v-else style="color: #999; font-size: 12px;">
            <div>æ‘˜è¦ï¼š{% raw %}{{ scope.row.content ? scope.row.content.substring(0, 50) + '...' : 'æ— å†…å®¹' }}{% endraw %}
            </div>
            (æ— æœ‰æ•ˆè¯„è®º)
          </div>
        </template>
      </el-table-column>

      <el-table-column label="AI æƒ…æ„Ÿåˆ†æç»“æœ" width="350">
        <template #default="scope">
          <div v-if="scope.row.ai_analysis" class="ai-badge">
            {% raw %}{{ formatAiResult(scope.row.ai_analysis) }}{% endraw %}
          </div>
          <el-tag v-else type="warning" size="small">ç­‰å¾…åˆ†æ</el-tag>
        </template>
      </el-table-column>
    </el-table>

    <!-- åˆ†é¡µæ§ä»¶ -->
    <div style="margin-top: 20px; display: flex; justify-content: center;">
      <el-pagination v-model:current-page="currentPage" :page-size="pageSize" :total="tableData.length"
        layout="prev, pager, next, jumper" @current-change="handlePageChange" />
    </div>

    <!-- Cookie æ•™ç¨‹å¼¹çª— -->
    <el-dialog v-model="showHelp" title="å¦‚ä½•è·å–çŸ¥ä¹ Cookieï¼Ÿ" width="600px">
      <div style="line-height: 1.6;">
        <div class="tutorial-step">
          <span class="step-title">ç¬¬ä¸€æ­¥ï¼šæ‰“å¼€ç½‘é¡µ</span>
          åœ¨ç”µè„‘ Chrome æµè§ˆå™¨ä¸­æ‰“å¼€ <a href="https://www.zhihu.com" target="_blank">çŸ¥ä¹å®˜ç½‘</a> å¹¶ç™»å½•è´¦å·ã€‚
        </div>
        <div class="tutorial-step">
          <span class="step-title">ç¬¬äºŒæ­¥ï¼šæ‰“å¼€å¼€å‘è€…å·¥å…·</span>
          æŒ‰ä¸‹é”®ç›˜ä¸Šçš„ <span class="code-block">F12</span> é”®ï¼ˆæˆ–å³é”®ç‚¹å‡»é¡µé¢ç©ºç™½å¤„ -> æ£€æŸ¥ï¼‰ï¼Œç„¶åç‚¹å‡»é¡¶éƒ¨çš„ <strong>"Network" (ç½‘ç»œ)</strong> æ ‡ç­¾ã€‚
        </div>
        <div class="tutorial-step">
          <span class="step-title">ç¬¬ä¸‰æ­¥ï¼šåˆ·æ–°é¡µé¢</span>
          æŒ‰ä¸‹ <span class="code-block">F5</span> åˆ·æ–°ç½‘é¡µï¼Œä½ ä¼šçœ‹åˆ° Network é¢æ¿é‡Œå‡ºç°å¾ˆå¤šæ•°æ®åŒ…ã€‚
        </div>
        <div class="tutorial-step">
          <span class="step-title">ç¬¬å››æ­¥ï¼šæ‰¾åˆ°è¯·æ±‚</span>
          åœ¨ Network é¢æ¿çš„ Filter (è¿‡æ»¤) æ¡†ä¸­è¾“å…¥ <span class="code-block">zhihu.com</span>ï¼Œéšæ„ç‚¹å‡»å·¦ä¾§åˆ—è¡¨ä¸­çš„ä»»æ„ä¸€ä¸ªè¯·æ±‚ï¼ˆæ¨èæ‰¾ type ä¸º document
          æˆ– xhr çš„è¯·æ±‚ï¼‰ã€‚
        </div>
        <div class="tutorial-step">
          <span class="step-title">ç¬¬äº”æ­¥ï¼šå¤åˆ¶ Cookie</span>
          åœ¨å³ä¾§é¢æ¿ç‚¹å‡» <strong>"Headers"</strong>ï¼Œå‘ä¸‹æ»šåŠ¨æ‰¾åˆ° <strong>"Request Headers"</strong> åŒºåŸŸï¼Œæ‰¾åˆ° <span
            class="code-block">Cookie:</span> åé¢é‚£ä¸€å¤§ä¸²å­—ç¬¦ï¼Œå…¨éƒ¨å¤åˆ¶ä¸‹æ¥ã€‚
        </div>
        <div class="tutorial-step">
          <span class="step-title">ç¬¬å…­æ­¥ï¼šç²˜è´´</span>
          å°†å¤åˆ¶çš„å†…å®¹ç²˜è´´åˆ°æœ¬ç³»ç»Ÿçš„è¾“å…¥æ¡†ä¸­å³å¯ã€‚
        </div>
      </div>
      <template #footer>
        <span class="dialog-footer">
          <el-button type="primary" @click="showHelp = false">æˆ‘å­¦ä¼šäº†</el-button>
        </span>
      </template>
    </el-dialog>

  </div>

  <script>
    const { createApp, ref, computed } = Vue;
    const { ElMessage } = ElementPlus;
    // æ³¨å†Œå›¾æ ‡
    const QuestionFilled = ElementPlusIconsVue.QuestionFilled;

    const app = createApp({
      components: {
        QuestionFilled
      },
      setup() {
        const activeTab = ref('crawl');
        const keyword = ref('äººå·¥æ™ºèƒ½é—®è¯Š');
        const platform = ref('xhs');
        const crawlCount = ref(50); // çˆ¬å–æ•°é‡ï¼Œé»˜è®¤50
        const zhihuCookie = ref('');
        const showHelp = ref(false);

        // ==================== JWT ç”¨æˆ·çŠ¶æ€ ====================
        const currentUser = ref(null);
        const jwtToken = ref(localStorage.getItem('jwt_token') || '');

        // åˆå§‹åŒ–ï¼šæ£€æŸ¥ URL å‚æ•°ï¼ˆOAuth å›è°ƒï¼‰æˆ– localStorage
        const initAuth = () => {
          const urlParams = new URLSearchParams(window.location.search);
          const token = urlParams.get('token');
          const username = urlParams.get('username');
          const avatarUrl = urlParams.get('avatar_url');
          const status = urlParams.get('status');

          if (token && username) {
            // OAuth å›è°ƒå¸¦æ¥çš„ token
            jwtToken.value = token;
            localStorage.setItem('jwt_token', token);
            currentUser.value = {
              username: decodeURIComponent(username),
              avatar_url: decodeURIComponent(avatarUrl || '')
            };
            localStorage.setItem('user_info', JSON.stringify(currentUser.value));
            // æ¸…é™¤ URL å‚æ•°
            window.history.replaceState({}, document.title, window.location.pathname);

            // æ£€æŸ¥è´¦å·çŠ¶æ€
            if (status === 'incomplete') {
              // è´¦å·æœªå®Œå–„ï¼Œè·³è½¬è®¾ç½®å¯†ç é¡µ
              ElMessage.warning('è¯·å…ˆè®¾ç½®å¯†ç ä»¥å®Œå–„è´¦å·ä¿¡æ¯');
              setTimeout(() => { window.location.href = '/complete-profile'; }, 1000);
              return;
            }

            ElMessage.success('ç™»å½•æˆåŠŸï¼');
          } else if (jwtToken.value) {
            // ä» localStorage æ¢å¤ï¼Œæ£€æŸ¥ JWT ä¸­çš„ status
            try {
              const payload = JSON.parse(atob(jwtToken.value.split('.')[1]));
              if (payload.status === 'incomplete') {
                window.location.href = '/complete-profile';
                return;
              }
            } catch (e) { /* ignore */ }

            const savedUser = localStorage.getItem('user_info');
            if (savedUser) {
              currentUser.value = JSON.parse(savedUser);
            }
          }
        };

        // é€€å‡ºç™»å½•
        const handleLogout = () => {
          localStorage.removeItem('jwt_token');
          localStorage.removeItem('user_info');
          jwtToken.value = '';
          currentUser.value = null;
          ElMessage.success('å·²é€€å‡ºç™»å½•');
          window.location.href = '/login';
        };

        // è·³è½¬ç™»å½•
        const goToLogin = () => {
          window.location.href = '/login';
        };

        // ç”¨æˆ·ä¸‹æ‹‰èœå•å‘½ä»¤å¤„ç†
        const handleUserCommand = (command) => {
          if (command === 'logout') {
            handleLogout();
          } else if (command === 'settings') {
            window.location.href = '/user-settings';
          } else if (command === 'password') {
            window.location.href = '/change-password';
          }
        };

        // é…ç½® axios æ‹¦æˆªå™¨ï¼Œè‡ªåŠ¨æºå¸¦ JWT
        axios.interceptors.request.use(config => {
          const token = localStorage.getItem('jwt_token');
          if (token) {
            config.headers.Authorization = `Bearer ${token}`;
          }
          return config;
        });

        // æ‰§è¡Œåˆå§‹åŒ–
        initAuth();

        // CSVä¸Šä¼ è¿‡æ»¤å‚æ•°
        const filterKeywords = ref('');
        const minCommentLength = ref(4);

        const loading = ref(false);
        const analyzing = ref(false);
        const tableData = ref([]);

        // åˆ†é¡µç›¸å…³
        const currentPage = ref(1);
        const pageSize = ref(50);

        // çˆ¬å–è¿›åº¦
        const crawlProgress = ref({
          current: 0,
          total: 0,
          percent: 0,
          status: 'å‡†å¤‡ä¸­...'
        });

        // AIåˆ†æè¿›åº¦
        const analyzeProgress = ref({
          currentBatch: 0,
          totalBatches: 0,
          batchSize: 50,
          percent: 0,
          status: '',
          results: []  // å­˜å‚¨æ¯æ‰¹ç»“æœ
        });

        // AIåˆ†ææ•°é‡
        const analyzeCount = ref(0);

        // åœæ­¢çˆ¬å–æ ‡å¿—
        let stopFlag = false;

        // å·²çˆ¬å–URLé›†åˆï¼ˆç”¨äºå»é‡ï¼‰
        const crawledUrls = new Set();


        // ==================== ã€è®¢é˜… & å‘Šè­¦ã€‘è¡¨å•å’Œåˆ—è¡¨ï¼ˆå‰ç«¯çŠ¶æ€ï¼‰ ====================
        // watchFormï¼šåˆ›å»ºè®¢é˜…ç”¨çš„è¡¨å•æ•°æ®ï¼ˆæäº¤ç»™åç«¯ /api/watchï¼‰
        // watchListï¼šåç«¯è¿”å›çš„è®¢é˜…åˆ—è¡¨ï¼ˆæ¸²æŸ“è¡¨æ ¼ç”¨ï¼‰
        const watchForm = ref({
          keyword: 'AIé—®è¯Š',          // è®¢é˜…å…³é”®è¯
          platform: 'xhs',            // å¹³å°ï¼šxhs / zhihu
          interval_minutes: 60,       // è®¢é˜…å‘¨æœŸï¼ˆåˆ†é’Ÿï¼‰â€”â€”åç«¯ä¼šæ¢ç®—æˆ seconds å­˜å‚¨
          negative_threshold: 1,      // è´Ÿé¢å‘Šè­¦é˜ˆå€¼ï¼ˆ>= è§¦å‘ï¼‰
          email: '2892626854@qq.com'  // å‘Šè­¦é‚®ç®±
        })
        const watchList = ref([])



        // è®¡ç®—å½“å‰é¡µæ•°æ®
        const pagedData = computed(() => {
          const start = (currentPage.value - 1) * pageSize.value;
          const end = start + pageSize.value;
          return tableData.value.slice(start, end);
        });

        // åˆ†é¡µå˜åŒ–
        const handlePageChange = (page) => {
          currentPage.value = page;
        };

        // å»é‡å‡½æ•°
        const deduplicateData = (newData) => {
          const uniqueData = [];
          for (const item of newData) {
            const key = item.url || item.content || JSON.stringify(item);
            if (!crawledUrls.has(key)) {
              crawledUrls.add(key);
              uniqueData.push(item);
            }
          }
          return uniqueData;
        };

        // æµå¼çˆ¬å–ï¼ˆæ”¯æŒå¤šå…³é”®è¯ï¼‰
        const startCrawl = async () => {
          if (!keyword.value) return ElMessage.warning('è¯·è¾“å…¥å…³é”®è¯');

          if (platform.value === 'zhihu' && !zhihuCookie.value) {
            return ElMessage.warning('çˆ¬å–çŸ¥ä¹å¿…é¡»å¡«å†™ Cookieï¼è¯·ç‚¹å‡»é—®å·æŸ¥çœ‹è·å–æ–¹æ³•ã€‚');
          }

          loading.value = true;
          tableData.value = [];
          crawledUrls.clear();
          stopFlag = false;
          currentPage.value = 1;

          // è§£æå¤šä¸ªå…³é”®è¯
          const keywords = keyword.value.split(/[,ï¼Œ]/).map(k => k.trim()).filter(k => k);
          const totalKeywords = keywords.length;
          const countPerKeyword = crawlCount.value;
          const totalCount = totalKeywords * countPerKeyword;

          // åˆå§‹åŒ–è¿›åº¦
          crawlProgress.value = {
            current: 0,
            total: totalCount,
            percent: 0,
            status: `å‡†å¤‡çˆ¬å– ${totalKeywords} ä¸ªå…³é”®è¯...`
          };

          const batchSize = 50; // æ¯æ‰¹50æ¡

          try {
            for (let kwIndex = 0; kwIndex < keywords.length && !stopFlag; kwIndex++) {
              const currentKeyword = keywords[kwIndex];
              let offset = 0;
              let keywordFetched = 0;

              crawlProgress.value.status = `æ­£åœ¨çˆ¬å–ã€${currentKeyword}ã€‘(${kwIndex + 1}/${totalKeywords})...`;

              while (keywordFetched < countPerKeyword && !stopFlag) {
                const currentBatchSize = Math.min(batchSize, countPerKeyword - keywordFetched);

                const res = await axios.post('/api/crawl_batch', {
                  keyword: currentKeyword,
                  platform: platform.value,
                  cookie: zhihuCookie.value,
                  batch_size: currentBatchSize,
                  offset: offset
                });

                if (res.data.code === 200) {
                  const newData = res.data.data || [];
                  console.log(`[çˆ¬å–] å…³é”®è¯=${currentKeyword}, offset=${offset}, è¯·æ±‚=${currentBatchSize}, è¿”å›=${newData.length}`);

                  const uniqueData = deduplicateData(newData);
                  tableData.value = [...tableData.value, ...uniqueData];

                  // æ›´æ–°è¿›åº¦
                  keywordFetched += newData.length;
                  crawlProgress.value.current = kwIndex * countPerKeyword + keywordFetched;
                  crawlProgress.value.percent = Math.round((crawlProgress.value.current / crawlProgress.value.total) * 100);

                  // è‡ªåŠ¨è·³è½¬åˆ°æœ€æ–°é¡µ
                  const totalPages = Math.ceil(tableData.value.length / pageSize.value);
                  currentPage.value = totalPages;

                  // å¦‚æœè¿”å›æ•°æ®ä¸º0ï¼Œè¯´æ˜æ²¡æœ‰æ›´å¤šæ•°æ®äº†
                  if (newData.length === 0) {
                    crawlProgress.value.status = `ã€${currentKeyword}ã€‘æ•°æ®å·²å…¨éƒ¨çˆ¬å–`;
                    break;
                  }

                  // offsetæŒ‰å®é™…è¿”å›æ•°æ®é‡ç´¯åŠ 
                  offset += newData.length;
                } else {
                  ElMessage.error(res.data.msg);
                  break;
                }

                // ç¨ä½œå»¶æ—¶
                await new Promise(r => setTimeout(r, 500));
              }
            }

            if (stopFlag) {
              crawlProgress.value.status = 'å·²æ‰‹åŠ¨åœæ­¢';
              ElMessage.warning('çˆ¬å–å·²åœæ­¢');
            } else {
              crawlProgress.value.status = 'çˆ¬å–å®Œæˆ';
              crawlProgress.value.percent = 100;
              ElMessage.success(`çˆ¬å–å®Œæˆï¼å…±è·å– ${tableData.value.length} æ¡æ•°æ®`);
            }
          } catch (error) {
            ElMessage.error('è¯·æ±‚å¤±è´¥: ' + error.message);
            crawlProgress.value.status = 'çˆ¬å–å‡ºé”™';
          } finally {
            loading.value = false;
          }
        };

        // åœæ­¢çˆ¬å–
        const stopCrawl = () => {
          stopFlag = true;
          crawlProgress.value.status = 'æ­£åœ¨åœæ­¢...';
        };

        // ä¸‹è½½æ•°æ®
        const downloadData = () => {
          if (tableData.value.length === 0) {
            return ElMessage.warning('æ²¡æœ‰æ•°æ®å¯ä¸‹è½½');
          }
          window.location.href = '/api/download_data';
        };

        const startAnalyze = async () => {
          analyzing.value = true;
          try {
            const res = await axios.post('/api/analyze', {});
            if (res.data.code === 200) {
              tableData.value = res.data.data;
              ElMessage.success('AI åˆ†æå®Œæˆ');
            } else {
              ElMessage.error(res.data.msg);
            }
          } catch (error) {
            ElMessage.error('åˆ†æè¯·æ±‚å¤±è´¥');
          } finally {
            analyzing.value = false;
          }
        };

        // æ‰¹é‡AIåˆ†æï¼ˆä½¿ç”¨SSEæµå¼è¿”å›ï¼‰
        const startBatchAnalyze = async () => {
          if (tableData.value.length === 0) {
            return ElMessage.warning('æ²¡æœ‰æ•°æ®å¯åˆ†æ');
          }

          analyzing.value = true;
          const total = analyzeCount.value === 0 ? tableData.value.length : Math.min(analyzeCount.value, tableData.value.length);
          const batchSize = 50;
          const totalBatches = Math.ceil(total / batchSize);

          analyzeProgress.value = {
            currentBatch: 0,
            totalBatches: totalBatches,
            batchSize: batchSize,
            percent: 0,
            status: 'æ­£åœ¨è¿æ¥AIæœåŠ¡...',
            results: []
          };

          try {
            const response = await fetch('/api/analyze_batch', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ max_count: analyzeCount.value, batch_size: batchSize })
            });

            const reader = response.body.getReader();
            const decoder = new TextDecoder();

            while (true) {
              const { done, value } = await reader.read();
              if (done) break;

              const text = decoder.decode(value);
              const lines = text.split('\n');

              for (const line of lines) {
                if (line.startsWith('data: ')) {
                  try {
                    const data = JSON.parse(line.substring(6));

                    if (data.status === 'complete') {
                      analyzeProgress.value.status = 'åˆ†æå®Œæˆ';
                      analyzeProgress.value.percent = 100;
                      ElMessage.success(data.msg || `AIåˆ†æå®Œæˆï¼å…±å¤„ç† ${data.total_batches} æ‰¹`);
                    } else if (data.status === 'batch_complete') {
                      // æ‰¹æ¬¡å®Œæˆ
                      analyzeProgress.value.currentBatch = data.batch;
                      analyzeProgress.value.percent = Math.round((data.batch / data.total_batches) * 100);
                      analyzeProgress.value.status = `ç¬¬ ${data.batch}/${data.total_batches} æ‰¹å®Œæˆ`;
                      analyzeProgress.value.results.push({
                        batch_num: data.batch,
                        count: data.count,
                        result: data.result
                      });
                    } else if (data.status === 'processing') {
                      // æ­£åœ¨å¤„ç†
                      analyzeProgress.value.currentBatch = data.batch;
                      analyzeProgress.value.status = data.msg || `æ­£åœ¨å¤„ç†ç¬¬ ${data.batch} æ‰¹...`;
                    } else if (data.status === 'error') {
                      ElMessage.warning(data.msg || `æ‰¹æ¬¡ ${data.batch} å¤„ç†å¤±è´¥`);
                    }
                  } catch (e) {
                    console.error('Parse SSE error:', e);
                  }
                }
              }
            }
          } catch (error) {
            ElMessage.error('AIåˆ†æè¯·æ±‚å¤±è´¥: ' + error.message);
            analyzeProgress.value.status = 'åˆ†æå‡ºé”™';
          } finally {
            analyzing.value = false;
          }
        };

        // ä¸‹è½½ã€ä¸Šä¼ ç­‰å‡½æ•°
        const downloadTemplate = () => { window.location.href = '/api/download_template'; };
        const uploadAction = '/api/upload';
        const uploadParams = computed(() => ({
          filter_keywords: filterKeywords.value,
          min_length: minCommentLength.value
        }));
        const beforeUpload = (file) => {
          const isCSV = file.name.endsWith('.csv');
          if (!isCSV) ElMessage.error('åªèƒ½ä¸Šä¼  CSV æ–‡ä»¶!');
          if (isCSV) loading.value = true;
          return isCSV;
        };
        const handleUploadSuccess = (res) => {
          loading.value = false;
          if (res.code === 200) {
            tableData.value = res.data;
            ElMessage.success(res.msg);
          } else {
            ElMessage.error(res.msg);
          }
        };
        const handleUploadError = (err) => {
          loading.value = false;
          ElMessage.error('ä¸Šä¼ å¤±è´¥');
        };
        const formatAiResult = (result) => {
          if (typeof result === 'object') return JSON.stringify(result, null, 2);
          return result;
        }

        // ==================== è¯äº‘åˆ†æç›¸å…³ ====================
        const txtUploadRef = ref(null);
        const mergeCSVRef = ref(null);
        const mergeTXTRef = ref(null);
        const mergedCSVRef = ref(null);
        const multiMergeRef = ref(null);
        const multiAnalyzeRef = ref(null);

        const txtFile = ref(null);
        const mergeCSVFile = ref(null);
        const mergeTXTFile = ref(null);
        const mergedCSVFile = ref(null);

        // å¤šCSVæ–‡ä»¶åˆ—è¡¨
        const multiMergeFiles = ref([]);
        const multiAnalyzeFiles = ref([]);

        const txtAnalyzing = ref(false);
        const csvAnalyzing = ref(false);
        const merging = ref(false);
        const multiMerging = ref(false);
        const multiAnalyzing = ref(false);

        // è¯äº‘æ•°æ®
        const wordcloudData = ref([]);
        const sentimentData = ref([]);

        // ç»Ÿè®¡æ•°æ®
        const analysisStats = ref({
          total: 0,
          validCount: 0
        });

        // æ–‡ä»¶ç»Ÿè®¡ï¼ˆå¤šæ–‡ä»¶åˆ†ææ—¶ï¼‰
        const fileStats = ref([]);

        const sentimentStats = ref({
          positive: 0,
          negative: 0,
          neutral: 0
        });

        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        const handleTxtChange = (file) => {
          txtFile.value = file.raw;
        };
        const handleMergeCSVChange = (file) => {
          mergeCSVFile.value = file.raw;
        };
        const handleMergeTXTChange = (file) => {
          mergeTXTFile.value = file.raw;
        };
        const handleMergedCSVChange = (file) => {
          mergedCSVFile.value = file.raw;
        };

        // å¤„ç†å¤šCSVæ–‡ä»¶é€‰æ‹© - åˆå¹¶ä¸‹è½½
        const handleMultiMergeChange = (file, fileList) => {
          multiMergeFiles.value = fileList;
        };

        // å¤„ç†å¤šCSVæ–‡ä»¶é€‰æ‹© - ç»Ÿä¸€åˆ†æ
        const handleMultiAnalyzeChange = (file, fileList) => {
          multiAnalyzeFiles.value = fileList;
        };

        // æ¸…ç©ºå¤šæ–‡ä»¶é€‰æ‹©
        const clearMultiMerge = () => {
          multiMergeFiles.value = [];
        };
        const clearMultiAnalyze = () => {
          multiAnalyzeFiles.value = [];
        };

        // åˆå¹¶å¤šä¸ªCSVå¹¶ä¸‹è½½
        const mergeMultipleCSV = async () => {
          if (multiMergeFiles.value.length < 2) {
            return ElMessage.warning('è¯·è‡³å°‘é€‰æ‹©2ä¸ªCSVæ–‡ä»¶è¿›è¡Œåˆå¹¶');
          }

          multiMerging.value = true;

          try {
            const formData = new FormData();
            for (const fileItem of multiMergeFiles.value) {
              formData.append('files', fileItem.raw);
            }

            const res = await axios.post('/api/merge_multiple_csv', formData, {
              responseType: 'blob'
            });

            // æ£€æŸ¥æ˜¯å¦æ˜¯JSONé”™è¯¯å“åº”
            const contentType = res.headers['content-type'];
            if (contentType && contentType.includes('application/json')) {
              const text = await res.data.text();
              const json = JSON.parse(text);
              ElMessage.error(json.msg || 'åˆå¹¶å¤±è´¥');
              return;
            }

            // ä¸‹è½½æ–‡ä»¶
            const url = window.URL.createObjectURL(new Blob([res.data]));
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', 'merged_multiple_csv.csv');
            document.body.appendChild(link);
            link.click();
            link.remove();
            window.URL.revokeObjectURL(url);

            ElMessage.success(`æˆåŠŸåˆå¹¶ ${multiMergeFiles.value.length} ä¸ªCSVæ–‡ä»¶`);
          } catch (error) {
            if (error.response && error.response.data instanceof Blob) {
              try {
                const text = await error.response.data.text();
                const json = JSON.parse(text);
                ElMessage.error(json.msg || 'åˆå¹¶å¤±è´¥');
              } catch {
                ElMessage.error('åˆå¹¶å¤±è´¥: ' + error.message);
              }
            } else {
              ElMessage.error('åˆå¹¶å¤±è´¥: ' + error.message);
            }
          } finally {
            multiMerging.value = false;
          }
        };

        // åˆ†æå¤šä¸ªCSVå¹¶ç”Ÿæˆè¯äº‘
        const analyzeMultipleCSV = async () => {
          if (multiAnalyzeFiles.value.length === 0) {
            return ElMessage.warning('è¯·é€‰æ‹©è¦åˆ†æçš„CSVæ–‡ä»¶');
          }

          multiAnalyzing.value = true;

          try {
            const formData = new FormData();
            for (const fileItem of multiAnalyzeFiles.value) {
              formData.append('files', fileItem.raw);
            }

            const res = await axios.post('/api/analyze_multiple_csv', formData);

            if (res.data.code === 200) {
              const data = res.data.data;
              wordcloudData.value = data.wordcloud;
              sentimentData.value = data.sentiment;
              analysisStats.value = {
                total: data.total,
                validCount: data.total,
                fileCount: data.file_count
              };

              // æ›´æ–°æ–‡ä»¶ç»Ÿè®¡
              fileStats.value = data.files || [];

              // æ›´æ–°æƒ…æ„Ÿç»Ÿè®¡
              for (const item of data.sentiment) {
                if (item.name.includes('Positive')) sentimentStats.value.positive = item.value;
                if (item.name.includes('Negative')) sentimentStats.value.negative = item.value;
                if (item.name.includes('Neutral')) sentimentStats.value.neutral = item.value;
              }

              ElMessage.success(`æˆåŠŸåˆ†æ ${data.file_count} ä¸ªCSVæ–‡ä»¶`);

              // æ¸²æŸ“å›¾è¡¨
              setTimeout(() => {
                renderWordcloud();
                renderSentimentChart();
              }, 100);
            } else {
              ElMessage.error(res.data.msg);
            }
          } catch (error) {
            ElMessage.error('åˆ†æå¤±è´¥: ' + error.message);
          } finally {
            multiAnalyzing.value = false;
          }
        };

        // åˆ†æTXTæ–‡ä»¶
        const analyzeTxt = async () => {
          if (!txtFile.value) {
            return ElMessage.warning('è¯·å…ˆé€‰æ‹©TXTæ–‡ä»¶');
          }

          txtAnalyzing.value = true;

          try {
            const formData = new FormData();
            formData.append('file', txtFile.value);

            const res = await axios.post('/api/upload_analysis_txt', formData);

            if (res.data.code === 200) {
              const data = res.data.data;
              wordcloudData.value = data.wordcloud;
              sentimentData.value = data.sentiment;
              analysisStats.value = {
                total: data.total,
                validCount: data.valid_count
              };

              // æ¸…ç©ºæ–‡ä»¶ç»Ÿè®¡ï¼ˆå•æ–‡ä»¶åˆ†æï¼‰
              fileStats.value = [];

              // æ›´æ–°æƒ…æ„Ÿç»Ÿè®¡
              for (const item of data.sentiment) {
                if (item.name.includes('Positive')) sentimentStats.value.positive = item.value;
                if (item.name.includes('Negative')) sentimentStats.value.negative = item.value;
                if (item.name.includes('Neutral')) sentimentStats.value.neutral = item.value;
              }

              ElMessage.success(res.data.msg);

              // æ¸²æŸ“å›¾è¡¨
              setTimeout(() => {
                renderWordcloud();
                renderSentimentChart();
              }, 100);
            } else {
              ElMessage.error(res.data.msg);
            }
          } catch (error) {
            ElMessage.error('åˆ†æå¤±è´¥: ' + error.message);
          } finally {
            txtAnalyzing.value = false;
          }
        };

        // åˆå¹¶CSVå’ŒTXTå¹¶ä¸‹è½½
        const mergeAndDownload = async () => {
          if (!mergeCSVFile.value || !mergeTXTFile.value) {
            return ElMessage.warning('è¯·é€‰æ‹©CSVå’ŒTXTæ–‡ä»¶');
          }

          merging.value = true;

          try {
            const formData = new FormData();
            formData.append('csv_file', mergeCSVFile.value);
            formData.append('txt_file', mergeTXTFile.value);

            const res = await axios.post('/api/merge_csv_with_analysis', formData, {
              responseType: 'blob'
            });

            // æ£€æŸ¥æ˜¯å¦æ˜¯JSONé”™è¯¯å“åº”
            const contentType = res.headers['content-type'];
            if (contentType && contentType.includes('application/json')) {
              // è¯»å–blobä¸ºæ–‡æœ¬å¹¶è§£æJSON
              const text = await res.data.text();
              const json = JSON.parse(text);
              ElMessage.error(json.msg || 'åˆå¹¶å¤±è´¥');
              return;
            }

            // ä¸‹è½½æ–‡ä»¶
            const url = window.URL.createObjectURL(new Blob([res.data]));
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', 'merged_analysis_result.csv');
            document.body.appendChild(link);
            link.click();
            link.remove();
            window.URL.revokeObjectURL(url);

            ElMessage.success('åˆå¹¶æˆåŠŸï¼Œæ­£åœ¨ä¸‹è½½');
          } catch (error) {
            // å°è¯•è§£æblobé”™è¯¯
            if (error.response && error.response.data instanceof Blob) {
              try {
                const text = await error.response.data.text();
                const json = JSON.parse(text);
                ElMessage.error(json.msg || 'åˆå¹¶å¤±è´¥');
              } catch {
                ElMessage.error('åˆå¹¶å¤±è´¥: ' + error.message);
              }
            } else {
              ElMessage.error('åˆå¹¶å¤±è´¥: ' + error.message);
            }
          } finally {
            merging.value = false;
          }
        };

        // ==================== ã€è®¢é˜… & å‘Šè­¦ã€‘è°ƒç”¨åç«¯ API ====================
        // è¯´æ˜ï¼šè¿™äº›æ¥å£éƒ½ç”±åç«¯æä¾›ï¼š
        // GET    /api/watch               è·å–è®¢é˜…åˆ—è¡¨
        // POST   /api/watch               åˆ›å»ºè®¢é˜…
        // POST   /api/watch/{id}/enable   å¯ç”¨/åœç”¨è®¢é˜…
        // POST   /api/watch/{id}/test     æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡è®¢é˜…ï¼ˆæ¼”ç¤ºç”¨ï¼šå¯è§¦å‘é‚®ä»¶ï¼‰
        // DELETE /api/watch/{id}          åˆ é™¤è®¢é˜…

        // æ‹‰å–è®¢é˜…åˆ—è¡¨
        const fetchWatches = async () => {
          const res = await axios.get('/api/watch')
          if (res.data.code === 200) {
            watchList.value = res.data.data || []
          } else {
            ElMessage.error(res.data.msg || 'è·å–è®¢é˜…å¤±è´¥')
          }
        }

        // åˆ›å»ºè®¢é˜…
        const createWatch = async () => {
          const f = watchForm.value
          if (!f.keyword || !f.keyword.trim()) {
            return ElMessage.warning('è¯·è¾“å…¥å…³é”®è¯')
          }
          if (!f.email || !f.email.trim()) {
            return ElMessage.warning('è¯·è¾“å…¥å‘Šè­¦é‚®ç®±')
          }

          const res = await axios.post('/api/watch', {
            keyword: f.keyword,
            platform: f.platform,
            interval_minutes: f.interval_minutes,
            negative_threshold: f.negative_threshold,
            notify: { email: f.email },
            enabled: true
          })

          if (res.data.code === 200) {
            ElMessage.success('è®¢é˜…åˆ›å»ºæˆåŠŸ')
            fetchWatches()
          } else {
            ElMessage.error(res.data.msg || 'åˆ›å»ºè®¢é˜…å¤±è´¥')
          }
        }

        // å¯ç”¨/åœç”¨è®¢é˜…
        const toggleWatch = async (w) => {
          const res = await axios.post(`/api/watch/${w.id}/enable`, {
            enabled: !w.enabled
          })
          if (res.data.code === 200) {
            ElMessage.success('çŠ¶æ€å·²æ›´æ–°')
            fetchWatches()
          } else {
            ElMessage.error(res.data.msg || 'æ›´æ–°å¤±è´¥')
          }
        }

        // æ‰‹åŠ¨æµ‹è¯•ï¼ˆä¼šèµ°åç«¯ä»»åŠ¡é“¾è·¯ï¼šç»Ÿè®¡â†’é˜ˆå€¼â†’é‚®ä»¶ï¼‰
        const testWatch = async (w) => {
          const res = await axios.post(`/api/watch/${w.id}/test`)
          if (res.data.code === 200) {
            ElMessage.success('æµ‹è¯•å®Œæˆï¼šè‹¥æ»¡è¶³é˜ˆå€¼å°†å‘é€é‚®ä»¶ï¼ˆæ£€æŸ¥é‚®ç®±ï¼‰')
          } else {
            ElMessage.error(res.data.msg || 'æµ‹è¯•å¤±è´¥')
          }
        }

        // åˆ é™¤è®¢é˜…
        const deleteWatch = async (w) => {
          const res = await axios.delete(`/api/watch/${w.id}`)
          if (res.data.code === 200) {
            ElMessage.success('åˆ é™¤æˆåŠŸ')
            fetchWatches()
          } else {
            ElMessage.error(res.data.msg || 'åˆ é™¤å¤±è´¥')
          }
        }

        // ==================== ã€è®¢é˜… & å‘Šè­¦ã€‘è°ƒç”¨åç«¯ API ====================

        // åˆ†æå·²åˆå¹¶çš„CSV
        const analyzeMergedCSV = async () => {
          if (!mergedCSVFile.value) {
            return ElMessage.warning('è¯·å…ˆé€‰æ‹©CSVæ–‡ä»¶');
          }

          csvAnalyzing.value = true;

          try {
            const formData = new FormData();
            formData.append('file', mergedCSVFile.value);

            const res = await axios.post('/api/analyze_merged_csv', formData);

            if (res.data.code === 200) {
              const data = res.data.data;
              wordcloudData.value = data.wordcloud;
              sentimentData.value = data.sentiment;
              analysisStats.value = {
                total: data.total,
                validCount: data.total
              };

              // æ¸…ç©ºæ–‡ä»¶ç»Ÿè®¡ï¼ˆå•æ–‡ä»¶åˆ†æï¼‰
              fileStats.value = [];

              // æ›´æ–°æƒ…æ„Ÿç»Ÿè®¡
              for (const item of data.sentiment) {
                if (item.name.includes('Positive')) sentimentStats.value.positive = item.value;
                if (item.name.includes('Negative')) sentimentStats.value.negative = item.value;
                if (item.name.includes('Neutral')) sentimentStats.value.neutral = item.value;
              }

              ElMessage.success(res.data.msg);

              // æ¸²æŸ“å›¾è¡¨
              setTimeout(() => {
                renderWordcloud();
                renderSentimentChart();
              }, 100);
            } else {
              ElMessage.error(res.data.msg);
            }
          } catch (error) {
            ElMessage.error('åˆ†æå¤±è´¥: ' + error.message);
          } finally {
            csvAnalyzing.value = false;
          }
        };

        // æ¸²æŸ“è¯äº‘å›¾
        const renderWordcloud = () => {
          const chartDom = document.getElementById('wordcloud-chart');
          if (!chartDom) return;

          const myChart = echarts.init(chartDom);

          const option = {
            tooltip: {
              show: true,
              formatter: '{b}: {c}'
            },
            series: [{
              type: 'wordCloud',
              shape: 'circle',
              left: 'center',
              top: 'center',
              width: '90%',
              height: '90%',
              sizeRange: [14, 60],
              rotationRange: [-45, 45],
              rotationStep: 15,
              gridSize: 8,
              drawOutOfBound: false,
              textStyle: {
                fontFamily: 'sans-serif',
                fontWeight: 'bold',
                color: function () {
                  const colors = ['#409EFF', '#67C23A', '#E6A23C', '#F56C6C', '#909399', '#9b59b6', '#3498db', '#1abc9c', '#e74c3c', '#2ecc71'];
                  return colors[Math.floor(Math.random() * colors.length)];
                }
              },
              emphasis: {
                textStyle: {
                  shadowBlur: 10,
                  shadowColor: '#333'
                }
              },
              data: wordcloudData.value
            }]
          };

          myChart.setOption(option);

          // å“åº”å¼
          window.addEventListener('resize', () => {
            myChart.resize();
          });
        };

        // æ¸²æŸ“æƒ…æ„Ÿåˆ†å¸ƒå›¾
        const renderSentimentChart = () => {
          const chartDom = document.getElementById('sentiment-chart');
          if (!chartDom) return;

          const myChart = echarts.init(chartDom);

          const option = {
            tooltip: {
              trigger: 'item',
              formatter: '{b}: {c} ({d}%)'
            },
            legend: {
              orient: 'vertical',
              left: 'left',
              top: 'center'
            },
            series: [{
              name: 'æƒ…æ„Ÿåˆ†å¸ƒ',
              type: 'pie',
              radius: ['40%', '70%'],
              center: ['60%', '50%'],
              avoidLabelOverlap: false,
              itemStyle: {
                borderRadius: 10,
                borderColor: '#fff',
                borderWidth: 2
              },
              label: {
                show: true,
                formatter: '{b}\n{d}%'
              },
              emphasis: {
                label: {
                  show: true,
                  fontSize: '16',
                  fontWeight: 'bold'
                }
              },
              data: [
                { value: sentimentStats.value.positive, name: 'æ­£é¢ (Positive)', itemStyle: { color: '#67C23A' } },
                { value: sentimentStats.value.negative, name: 'è´Ÿé¢ (Negative)', itemStyle: { color: '#F56C6C' } },
                { value: sentimentStats.value.neutral, name: 'ä¸­æ€§ (Neutral)', itemStyle: { color: '#909399' } }
              ]
            }]
          };

          myChart.setOption(option);


          // å“åº”å¼
          window.addEventListener('resize', () => {
            myChart.resize();
          });
        };

        return {
          activeTab,
          keyword,
          platform,
          crawlCount,
          zhihuCookie,
          showHelp,
          // ç”¨æˆ·è®¤è¯ç›¸å…³
          currentUser,
          goToLogin,
          handleUserCommand,
          filterKeywords,
          minCommentLength,
          loading,
          analyzing,
          tableData,
          currentPage,
          pageSize,
          pagedData,
          crawlProgress,
          analyzeProgress,
          analyzeCount,
          startCrawl,
          stopCrawl,
          downloadData,
          handlePageChange,
          startAnalyze,
          startBatchAnalyze,
          downloadTemplate,
          uploadAction,
          uploadParams,
          beforeUpload,
          handleUploadSuccess,
          handleUploadError,
          formatAiResult,
          // è¯äº‘ç›¸å…³
          txtUploadRef,
          mergeCSVRef,
          mergeTXTRef,
          mergedCSVRef,
          multiMergeRef,
          multiAnalyzeRef,
          multiMergeFiles,
          multiAnalyzeFiles,
          txtAnalyzing,
          csvAnalyzing,
          merging,
          multiMerging,
          multiAnalyzing,
          wordcloudData,
          sentimentData,
          analysisStats,
          sentimentStats,
          fileStats,
          handleTxtChange,
          handleMergeCSVChange,
          handleMergeTXTChange,
          handleMergedCSVChange,
          handleMultiMergeChange,
          handleMultiAnalyzeChange,
          clearMultiMerge,
          clearMultiAnalyze,
          mergeMultipleCSV,
          analyzeMultipleCSV,
          analyzeTxt,
          mergeAndDownload,
          analyzeMergedCSV,
          // ==================== ã€è®¢é˜… & å‘Šè­¦ã€‘å¯¼å‡ºç»™é¡µé¢ç”¨ ====================
          watchForm,
          watchList,
          fetchWatches,
          createWatch,
          toggleWatch,
          testWatch,
          deleteWatch,

        };
      }
    });

    app.use(ElementPlus);
    app.mount('#app');
  </script>
</body>

</html>