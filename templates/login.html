<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½• - èˆ†æƒ…åˆ†æç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', sans-serif;
        }

        .login-container {
            text-align: center;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 50px 40px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            min-width: 420px;
            animation: fadeIn 0.6s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo {
            font-size: 50px;
            margin-bottom: 15px;
        }

        .title {
            font-size: 26px;
            font-weight: 700;
            color: #303133;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 14px;
            color: #909399;
            margin-bottom: 30px;
        }

        .tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 2px solid #e4e7ed;
        }

        .tab {
            flex: 1;
            padding: 12px 0;
            cursor: pointer;
            font-size: 15px;
            color: #909399;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }

        .tab.active {
            color: #409eff;
            border-bottom-color: #409eff;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            color: #606266;
            margin-bottom: 8px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #dcdfe6;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #409eff;
        }

        .submit-btn {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            font-weight: 600;
            color: #fff;
            background: linear-gradient(135deg, #409eff, #66b1ff);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(64, 158, 255, 0.4);
        }

        .submit-btn:disabled {
            background: #a0cfff;
            cursor: not-allowed;
            transform: none;
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: #c0c4cc;
            font-size: 13px;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #e4e7ed;
        }

        .divider span {
            padding: 0 15px;
        }

        .gitee-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 14px;
            font-size: 15px;
            font-weight: 600;
            color: #fff;
            background: linear-gradient(135deg, #C71D23, #E33E38);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .gitee-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(199, 29, 35, 0.4);
        }

        .gitee-btn img {
            width: 22px;
            height: 22px;
        }

        .error-msg {
            margin-top: 15px;
            padding: 10px 15px;
            background: #fef0f0;
            border: 1px solid #fde2e2;
            border-radius: 8px;
            color: #F56C6C;
            font-size: 13px;
        }

        .footer {
            margin-top: 25px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>

<body>
    <div id="app" class="login-container">
        <div class="login-card">
            <div class="logo">ğŸ•·ï¸</div>
            <h1 class="title">èˆ†æƒ…åˆ†æç³»ç»Ÿ</h1>
            <p class="subtitle">ç™»å½•æˆ–æ³¨å†Œä»¥ç»§ç»­ä½¿ç”¨</p>

            <!-- Tab åˆ‡æ¢ -->
            <div class="tabs">
                <div class="tab" :class="{ active: activeTab === 'login' }" @click="activeTab = 'login'">ç™»å½•</div>
                <div class="tab" :class="{ active: activeTab === 'register' }" @click="activeTab = 'register'">æ³¨å†Œ</div>
            </div>

            <!-- ç™»å½•è¡¨å• -->
            <div v-if="activeTab === 'login'">
                <div class="form-group">
                    <label>ç”¨æˆ·å</label>
                    <input type="text" v-model="loginForm.username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" @keyup.enter="handleLogin">
                </div>
                <div class="form-group">
                    <label>å¯†ç </label>
                    <input type="password" v-model="loginForm.password" placeholder="è¯·è¾“å…¥å¯†ç " @keyup.enter="handleLogin">
                </div>
                <button class="submit-btn" @click="handleLogin" :disabled="loading">
                    {% raw %}{{ loading ? 'ç™»å½•ä¸­...' : 'ç™»å½•' }}{% endraw %}
                </button>
            </div>

            <!-- æ³¨å†Œè¡¨å• -->
            <div v-if="activeTab === 'register'">
                <div class="form-group">
                    <label>ç”¨æˆ·å</label>
                    <input type="text" v-model="registerForm.username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                </div>
                <div class="form-group">
                    <label>å¯†ç </label>
                    <input type="password" v-model="registerForm.password" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆæœ€å°‘6ä½ï¼‰">
                </div>
                <div class="form-group">
                    <label>ç¡®è®¤å¯†ç </label>
                    <input type="password" v-model="registerForm.confirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç "
                        @keyup.enter="handleRegister">
                </div>
                <button class="submit-btn" @click="handleRegister" :disabled="loading">
                    {% raw %}{{ loading ? 'æ³¨å†Œä¸­...' : 'æ³¨å†Œ' }}{% endraw %}
                </button>
            </div>

            <div class="divider"><span>æˆ–è€…</span></div>

            <a href="/auth/gitee/login" class="gitee-btn">
                <img src="https://gitee.com/favicon.ico" alt="Gitee">
                ä½¿ç”¨ Gitee è´¦å·ç™»å½•
            </a>

            <div v-if="errorMsg" class="error-msg">{% raw %}{{ errorMsg }}{% endraw %}</div>
        </div>

        <p class="footer">Â© 2024 èˆ†æƒ…æ•°æ®è·å–ä¸ AI åˆ†æç³»ç»Ÿ</p>
    </div>

    <script>
        const { createApp, ref } = Vue;

        createApp({
            setup() {
                const activeTab = ref('login');
                const loading = ref(false);
                const errorMsg = ref('');

                const loginForm = ref({ username: '', password: '' });
                const registerForm = ref({ username: '', password: '', confirmPassword: '' });

                // æ£€æŸ¥ URL å‚æ•°ä¸­çš„é”™è¯¯
                const urlParams = new URLSearchParams(window.location.search);
                const urlError = urlParams.get('error');
                if (urlError) {
                    const errorMap = {
                        'no_code': 'æˆæƒå¤±è´¥ï¼šæœªè·å–åˆ°æˆæƒç ',
                        'token_exchange_failed': 'æˆæƒå¤±è´¥ï¼šè·å–ä»¤ç‰Œå¤±è´¥',
                        'user_info_failed': 'æˆæƒå¤±è´¥ï¼šè·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥'
                    };
                    errorMsg.value = errorMap[urlError] || urlError;
                }

                const handleLogin = async () => {
                    if (!loginForm.value.username || !loginForm.value.password) {
                        errorMsg.value = 'è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ';
                        return;
                    }
                    loading.value = true;
                    errorMsg.value = '';
                    try {
                        const res = await axios.post('/api/auth/login/local', loginForm.value);
                        if (res.data.code === 200) {
                            localStorage.setItem('jwt_token', res.data.data.token);
                            localStorage.setItem('user_info', JSON.stringify(res.data.data.user));
                            ElementPlus.ElMessage.success('ç™»å½•æˆåŠŸï¼');
                            setTimeout(() => { window.location.href = '/'; }, 500);
                        } else {
                            errorMsg.value = res.data.message;
                        }
                    } catch (err) {
                        errorMsg.value = err.response?.data?.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';
                    } finally {
                        loading.value = false;
                    }
                };

                const handleRegister = async () => {
                    if (!registerForm.value.username || !registerForm.value.password) {
                        errorMsg.value = 'è¯·å¡«å†™å®Œæ•´ä¿¡æ¯';
                        return;
                    }
                    if (registerForm.value.password !== registerForm.value.confirmPassword) {
                        errorMsg.value = 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´';
                        return;
                    }
                    if (registerForm.value.password.length < 6) {
                        errorMsg.value = 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½';
                        return;
                    }
                    loading.value = true;
                    errorMsg.value = '';
                    try {
                        const res = await axios.post('/api/auth/register', {
                            username: registerForm.value.username,
                            password: registerForm.value.password
                        });
                        if (res.data.code === 200) {
                            ElementPlus.ElMessage.success('æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•');
                            // åˆ‡æ¢åˆ°ç™»å½•Tabï¼Œä¸è‡ªåŠ¨ç™»å½•
                            activeTab.value = 'login';
                            loginForm.value.username = registerForm.value.username;
                            loginForm.value.password = '';
                            registerForm.value = { username: '', password: '', confirmPassword: '' };
                        } else {
                            errorMsg.value = res.data.message;
                        }
                    } catch (err) {
                        errorMsg.value = err.response?.data?.message || 'æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';
                    } finally {
                        loading.value = false;
                    }
                };

                return { activeTab, loading, errorMsg, loginForm, registerForm, handleLogin, handleRegister };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>

</html>